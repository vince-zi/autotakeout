<!DOCTYPE html>
<html lang="zh-CN">

<head>
    <meta charset="utf-8" />
    <meta content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no, viewport-fit=cover"
        name="viewport" />
    <title>ä»Šæ—¥æ­é…</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <script src="https://code.iconify.design/iconify-icon/1.0.7/iconify-icon.min.js"></script>
    <link href="https://api.fontshare.com/v2/css?f[]=zodiak@400,500,700&f[]=pally@400,500,700&display=swap"
        rel="stylesheet">
    <script>
        tailwind.config = {
            theme: {
                extend: {
                    colors: { cream: '#fffcf8', dusty: { rose: '#d9a59d', 'rose-dark': '#b57b72' }, sage: { green: '#c8d5c4', 'green-dark': '#8a9a85' }, charcoal: '#5c5552', 'text-light': '#948c89' },
                    fontFamily: { serif: ['Zodiak', 'serif'], sans: ['Pally', 'sans-serif'] },
                    boxShadow: { 'bubble': '0 8px 24px -6px rgba(217, 165, 157, 0.25)', 'card': '0 4px 20px -5px rgba(0,0,0,0.05)' },
                    animation: { 'fade-in-up': 'fadeInUp 0.6s ease-out forwards' },
                    keyframes: { fadeInUp: { '0%': { opacity: 0, transform: 'translateY(20px)' }, '100%': { opacity: 1, transform: 'translateY(0)' } } }
                }
            }
        }
    </script>
</head>

<body class="min-h-screen bg-cream text-charcoal font-sans p-6 pb-24">

    <!-- Header -->
    <header class="mb-8 pt-4">
        <a href="family.html"
            class="inline-flex items-center gap-1 text-text-light text-sm mb-4 hover:text-dusty-rose transition-colors">
            <iconify-icon icon="lucide:arrow-left"></iconify-icon> é‡é€‰
        </a>
        <h1 class="font-serif text-2xl text-charcoal font-bold">ğŸš ä»Šæ—¥å®¶åº­æ­é… (2-3äººä»½)</h1>
        <p class="text-text-light text-sm mt-1" id="subtitle">æ ¹æ®ä½ çš„å£å‘³ç”Ÿæˆ</p>
    </header>

    <!-- Meal Cards (Dynamically Injected) -->
    <div class="grid gap-6 mb-10" id="meal-container">
        <!-- Template -->
        <!-- <div class="bg-white p-6 rounded-[2rem] shadow-card border border-transparent hover:border-dusty-rose/30 transition-all flex gap-4">
            <div class="w-16 h-16 rounded-2xl bg-cream flex items-center justify-center text-3xl shrink-0">ğŸ…</div>
            <div>
                <span class="text-xs font-bold text-dusty-rose uppercase tracking-wider">ä¸»èœ</span>
                <h3 class="text-xl font-bold text-charcoal mb-1">ç•ªèŒ„ç‚’è›‹</h3>
                <p class="text-sm text-text-light">ç¨³å®šã€å¿«ã€ä¸ç¿»è½¦</p>
            </div>
        </div> -->
    </div>

    <!-- Shopping List -->
    <div class="mb-10 animate-fade-in-up" style="animation-delay: 200ms;">
        <h2 class="text-lg font-bold mb-4 flex items-center gap-2">
            <iconify-icon icon="lucide:shopping-cart" class="text-sage-green-dark"></iconify-icon>
            éœ€è¦ä¹°çš„ä¸œè¥¿
        </h2>
        <div class="bg-white p-6 rounded-[2rem] shadow-card relative overflow-hidden">
            <ul class="space-y-3 text-sm" id="shopping-list">
                <!-- List Items -->
            </ul>

            <!-- CTA -->
            <div class="mt-6 pt-6 border-t border-dashed border-gray-100">
                <a href="https://s.taobao.com/search?q=ç”Ÿé²œé…é€" target="_blank"
                    class="w-full py-3 rounded-full bg-sage-green text-white font-bold text-center block shadow-bubble hover:shadow-bubble-hover hover:-translate-y-1 transition-all">
                    å»æ·˜å®é—ªé€ä¹°è¿™äº› â†’
                </a>
            </div>
        </div>
    </div>

    <!-- Recipes -->
    <div class="animate-fade-in-up" style="animation-delay: 400ms;">
        <h2 class="text-lg font-bold mb-4 flex items-center gap-2">
            <iconify-icon icon="lucide:chef-hat" class="text-sage-green-dark"></iconify-icon>
            æç®€åšæ³•
        </h2>
        <div class="space-y-6" id="recipe-container">
            <!-- Recipes -->
        </div>
    </div>

    <script>
        // Data
        const menus = {
            'light-none': {
                dishes: [
                    { type: 'ä¸»èœ', name: 'ç•ªèŒ„ç‚’è›‹', emoji: 'ğŸ…', desc: 'ç¨³å®šã€å¿«ã€ä¸ç¿»è½¦', steps: ['é¸¡è›‹æ‰“æ•£ç‚’ç†Ÿç››å‡º', 'ç•ªèŒ„ç‚’å‡ºæ±', 'å€’å›é¸¡è›‹ç¿»ç‚’'], ingredients: ['é¸¡è›‹Ã—4', 'ç•ªèŒ„Ã—2'] },
                    { type: 'è”¬èœ', name: 'æ¸…ç‚’è¥¿å…°èŠ±', emoji: 'ğŸ¥¦', desc: 'è§£è…»ã€è¡¥å……è”¬èœ', steps: ['è¥¿å…°èŠ±ç„¯æ°´1åˆ†é’Ÿ', 'è’œæœ«çˆ†é¦™', 'å¤§ç«å¿«ç‚’å‡ºé”…'], ingredients: ['è¥¿å…°èŠ±Ã—1', 'å¤§è’œ'] },
                    { type: 'æ±¤', name: 'ç´«èœè›‹èŠ±æ±¤', emoji: 'ğŸ¥£', desc: '5åˆ†é’Ÿå®Œæˆ', steps: ['æ°´çƒ§å¼€ä¸‹ç´«èœ', 'æ·‹å…¥è›‹æ¶²', 'åŠ ç›å’Œé¦™æ²¹'], ingredients: ['ç´«èœ', 'é¸¡è›‹Ã—1'] }
                ]
            },
            'light-no_meat': {
                dishes: [
                    { type: 'ä¸»èœ', name: 'åƒé¡µè±†è…', emoji: 'ğŸ˜', desc: 'Qå¼¹å…¥å‘³ï¼Œä¸‹é¥­ç¥å™¨', steps: ['è±†è…åˆ‡ç‰‡ç…è‡³ä¸¤é¢é‡‘é»„', 'åŠ å…¥é’çº¢æ¤’ç¿»ç‚’', 'ç”ŸæŠ½è€—æ²¹è°ƒå‘³'], ingredients: ['åƒé¡µè±†è…', 'é’çº¢æ¤’'] },
                    { type: 'è”¬èœ', name: 'è’œè“‰æ²¹éº¦èœ', emoji: 'ğŸ¥¬', desc: 'æ¸…è„†çˆ½å£', steps: ['æ²¹éº¦èœæ´—å‡€åˆ‡æ®µ', 'å¤šæ”¾è’œæœ«çˆ†é¦™', 'å¤§ç«å¿«ç‚’'], ingredients: ['æ²¹éº¦èœ', 'å¤§è’œ'] },
                    { type: 'æ±¤', name: 'ç•ªèŒ„èŒè‡æ±¤', emoji: 'ğŸ„', desc: 'é²œç¾å¼€èƒƒ', steps: ['ç•ªèŒ„ç‚’å‡ºæ±', 'åŠ æ°´æ”¾å…¥é‡‘é’ˆè‡', 'ç…®å¼€è°ƒå‘³'], ingredients: ['ç•ªèŒ„', 'é‡‘é’ˆè‡'] }
                ]
            },
            'normal-none': {
                dishes: [
                    { type: 'ä¸»èœ', name: 'çº¢çƒ§è‚‰(ç®€æ˜“ç‰ˆ)', emoji: 'ğŸ¥©', desc: 'ç¡¬èœå…¶å®å¾ˆç®€å•', steps: ['äº”èŠ±è‚‰ç…¸ç‚’å‡ºæ²¹', 'åŠ ç”ŸæŠ½è€æŠ½å†°ç³–', 'åŠ æ°´ç‚–40åˆ†é’Ÿ'], ingredients: ['äº”èŠ±è‚‰500g', 'å†°ç³–'] },
                    { type: 'è”¬èœ', name: 'æ‰‹æ’•åŒ…èœ', emoji: 'ğŸ¥¬', desc: 'è„†å«©çˆ½å£', steps: ['åŒ…èœæ‰‹æ’•æˆç‰‡', 'æ”¾å…¥å¹²è¾£æ¤’çˆ†é¦™', 'å¤§ç«çˆ†ç‚’åŠ é†‹'], ingredients: ['åŒ…èœ', 'å¹²è¾£æ¤’'] },
                    { type: 'æ±¤', name: 'å†¬ç“œæ’éª¨æ±¤', emoji: 'ğŸ²', desc: 'æ¸…çƒ­å»ç«', steps: ['æ’éª¨ç„¯æ°´', 'åŠ æ°´ç‚–30åˆ†é’Ÿ', 'æ”¾å…¥å†¬ç“œå†ç…®10åˆ†'], ingredients: ['æ’éª¨', 'å†¬ç“œ'] }
                ]
            },
            'normal-no_spicy': {
                dishes: [
                    { type: 'ä¸»èœ', name: 'åœŸè±†ç‚–ç‰›è…©', emoji: 'ğŸ¥”', desc: 'è½¯çƒ‚å…¥å‘³', steps: ['ç‰›è…©ç‚–ç…®1å°æ—¶', 'åŠ å…¥åœŸè±†å—', 'æ”¶æ±å‡ºé”…'], ingredients: ['ç‰›è…©', 'åœŸè±†'] },
                    { type: 'è”¬èœ', name: 'æ¸…ç‚’å°ç™½èœ', emoji: 'ğŸ¥¬', desc: 'è¡¥å……ç»´ç”Ÿç´ ', steps: ['å¤§ç«å¿«ç‚’', 'åŠ ç›è°ƒå‘³', 'å‡ºé”…'], ingredients: ['å°ç™½èœ'] },
                    { type: 'æ±¤', name: 'ç‰ç±³æ’éª¨æ±¤', emoji: 'ğŸŒ½', desc: 'æ¸…ç”œå¥½å–', steps: ['æ’éª¨ç„¯æ°´', 'åŠ ç‰ç±³èƒ¡èåœ', 'ç‚–ç…®1å°æ—¶'], ingredients: ['æ’éª¨', 'ç‰ç±³', 'èƒ¡èåœ'] }
                ]
            },
            'savory-none': {
                dishes: [
                    { type: 'ä¸»èœ', name: 'è¾£æ¤’ç‚’è‚‰', emoji: 'ğŸŒ¶ï¸', desc: 'ç±³é¥­æ€æ‰‹', steps: ['äº”èŠ±è‚‰ç…¸ç‚’', 'åŠ å…¥é’æ¤’æ‹è’œ', 'è±†è±‰é…±æ²¹è°ƒå‘³/çˆ†ç‚’'], ingredients: ['äº”èŠ±è‚‰', 'é’æ¤’(èºä¸æ¤’)'] },
                    { type: 'è”¬èœ', name: 'å¹²ç…¸å››å­£è±†', emoji: 'ğŸ¥—', desc: 'å’¸é¦™ä¸‹é¥­', steps: ['å››å­£è±†ç‚¸è‡³è™çš®çŠ¶', 'åŠ è‚‰æœ«å¹²è¾£æ¤’ç¢', 'ç¿»ç‚’å‡åŒ€'], ingredients: ['å››å­£è±†', 'è‚‰æœ«', 'å¹²è¾£æ¤’'] },
                    { type: 'æ±¤', name: 'é…¸è¾£æ±¤', emoji: 'ğŸ¥£', desc: 'é…¸çˆ½å¼€èƒƒ', steps: ['æœ¨è€³ç«è…¿ä¸ç…®å¼€', 'å‹¾èŠ¡æ‰“è›‹èŠ±', 'åŠ é†‹å’Œèƒ¡æ¤’ç²‰'], ingredients: ['æœ¨è€³', 'ç«è…¿', 'é™ˆé†‹', 'èƒ¡æ¤’ç²‰'] }
                ]
            }
        };

        // Fallback
        const defaultMenu = menus['light-none'];

        // Logic
        function loadContent() {
            const prefs = JSON.parse(sessionStorage.getItem('familyMealPrefs') || '{}');
            const taste = prefs.taste || 'light';
            const restriction = prefs.restriction || 'none';

            // Allow sloppy matching or defaulting
            let key = `${taste}-${restriction}`;

            // Partial fallbacks if exact combo missing
            if (!menus[key]) {
                if (restriction === 'no_meat') key = 'light-no_meat'; // Fallback for veg
                else if (taste === 'savory') key = 'savory-none';
                else if (taste === 'normal') key = 'normal-none';
                else key = 'light-none';
            }

            const menu = menus[key] || defaultMenu;
            renderMenu(menu);
        }

        function renderMenu(menu) {
            const container = document.getElementById('meal-container');
            const shoppingList = document.getElementById('shopping-list');
            const recipeContainer = document.getElementById('recipe-container');

            let allIngredients = [];

            menu.dishes.forEach((dish, index) => {
                // 1. Meal Card
                const card = document.createElement('div');
                card.className = "bg-white p-6 rounded-[2rem] shadow-card border border-transparent hover:border-dusty-rose/30 transition-all flex gap-4 animate-fade-in-up";
                card.style.animationDelay = `${index * 100}ms`;
                card.innerHTML = `
                    <div class="w-16 h-16 rounded-2xl bg-cream flex items-center justify-center text-3xl shrink-0 border border-sage-green/10">${dish.emoji}</div>
                    <div>
                        <span class="text-[10px] font-bold text-dusty-rose uppercase tracking-wider bg-dusty-rose/10 px-2 py-0.5 rounded-full">${dish.type}</span>
                        <h3 class="text-xl font-bold text-charcoal mb-1 mt-1">${dish.name}</h3>
                        <p class="text-sm text-text-light">${dish.desc}</p>
                    </div>
                `;
                container.appendChild(card);

                // Collect Ingredients
                allIngredients = [...allIngredients, ...dish.ingredients];

                // 2. Recipe
                const recipe = document.createElement('div');
                recipe.className = "bg-white p-6 rounded-[2rem] shadow-sm";
                recipe.innerHTML = `
                    <h3 class="font-bold text-charcoal mb-3 flex items-center gap-2">
                        <span>${dish.emoji}</span> ${dish.name}
                    </h3>
                    <ol class="space-y-2 relative border-l border-sage-green/30 ml-1 pl-4">
                        ${dish.steps.map(step => `<li class="text-sm text-charcoal/80 leading-relaxed">${step}</li>`).join('')}
                    </ol>
                `;
                recipeContainer.appendChild(recipe);
            });

            // Shopping List Render
            // Deduplicate logic could go here, but for simple strings Set is okay-ish (though "Tomato x2" vs "Tomato" is tricky. Keeping simple for now)
            const uniqueIngredients = [...new Set(allIngredients)];
            uniqueIngredients.forEach(item => {
                const li = document.createElement('li');
                li.className = "flex items-center gap-3 text-charcoal/80";
                li.innerHTML = `
                    <iconify-icon icon="lucide:circle" class="text-[6px] text-sage-green-dark"></iconify-icon>
                    <span>${item}</span>
                `;
                shoppingList.appendChild(li);
            });
        }

        // Init
        loadContent();

    </script>
</body>

</html>