<!DOCTYPE html>
<html class="light" lang="zh-CN">

<head>
    <meta charset="utf-8" />
    <meta content="width=device-width, initial-scale=1.0" name="viewport" />
    <title>åƒåå¤ç›˜ - é¥®é£Ÿè§‰å¯Ÿ</title>
    <link href="https://fonts.googleapis.com" rel="preconnect" />
    <link crossorigin="" href="https://fonts.gstatic.com" rel="preconnect" />
    <link href="https://fonts.googleapis.com/css2?family=Plus+Jakarta+Sans:wght@400;500;600;700;800&display=swap"
        rel="stylesheet" />
    <link href="https://fonts.googleapis.com/css2?family=Material+Symbols+Outlined:wght,FILL@100..700,0..1&display=swap"
        rel="stylesheet" />
    <script src="https://cdn.tailwindcss.com"></script>
    <script>
        tailwind.config = {
            darkMode: 'class',
            theme: {
                extend: {
                    colors: {
                        primary: '#d4a574',
                        'primary-hover': '#c49464',
                        'bg-light': '#faf6f0',
                        'bg-dark': '#1a1410',
                        'card-light': '#ffffff',
                        'card-dark': '#2a221c',
                        'text-main': '#3d2e22',
                        'text-sub': '#8b7355',
                        'accent-cream': '#f5e6d3',
                    }
                }
            }
        }
    </script>
    <style>
        body {
            font-family: 'Plus Jakarta Sans', -apple-system, BlinkMacSystemFont, sans-serif;
        }

        .emoji-btn {
            transition: all 0.2s;
        }

        .emoji-btn:hover {
            transform: scale(1.1);
        }

        .emoji-btn.selected {
            transform: scale(1.2);
            box-shadow: 0 0 0 3px rgba(212, 165, 116, 0.4);
        }
    </style>
</head>

<body class="bg-bg-light dark:bg-bg-dark min-h-screen">
    <div class="max-w-md mx-auto px-4 py-6">
        <!-- å¤´éƒ¨ -->
        <header class="flex items-center justify-between mb-6">
            <a href="code.html" class="flex items-center gap-2 text-text-sub hover:text-primary transition-colors">
                <span class="material-symbols-outlined">arrow_back</span>
                <span class="text-sm">è¿”å›</span>
            </a>
            <h1 class="text-lg font-bold text-text-main dark:text-white">ğŸœ åƒåå¤ç›˜</h1>
            <div class="w-16"></div>
        </header>

        <!-- ä¸»ä½“ -->
        <main class="space-y-6">
            <!-- ä»Šå¤©åƒäº†ä»€ä¹ˆ -->
            <div class="bg-card-light dark:bg-card-dark rounded-2xl p-5 shadow-sm">
                <h2 class="font-bold text-text-main dark:text-white mb-4">åˆšæ‰åƒäº†ä»€ä¹ˆï¼Ÿ</h2>
                <input type="text" id="food-input" placeholder="å¦‚ï¼šéº¦å½“åŠ³åŒå±‚å‰å£«æ±‰å ¡å¥—é¤"
                    class="w-full px-4 py-3 rounded-xl bg-accent-cream/50 dark:bg-[#3a2e26] border-none text-text-main dark:text-white placeholder:text-text-sub/60 focus:outline-none focus:ring-2 focus:ring-primary">
                <div class="flex gap-2 mt-3 flex-wrap" id="quick-foods">
                    <button
                        class="quick-food px-3 py-1.5 text-sm bg-accent-cream dark:bg-[#3a2e26] rounded-full text-text-sub hover:bg-primary hover:text-white transition-colors">ğŸ”
                        æ±‰å ¡</button>
                    <button
                        class="quick-food px-3 py-1.5 text-sm bg-accent-cream dark:bg-[#3a2e26] rounded-full text-text-sub hover:bg-primary hover:text-white transition-colors">ğŸœ
                        é¢æ¡</button>
                    <button
                        class="quick-food px-3 py-1.5 text-sm bg-accent-cream dark:bg-[#3a2e26] rounded-full text-text-sub hover:bg-primary hover:text-white transition-colors">ğŸ•
                        æŠ«è¨</button>
                    <button
                        class="quick-food px-3 py-1.5 text-sm bg-accent-cream dark:bg-[#3a2e26] rounded-full text-text-sub hover:bg-primary hover:text-white transition-colors">ğŸ¥—
                        è½»é£Ÿ</button>
                    <button
                        class="quick-food px-3 py-1.5 text-sm bg-accent-cream dark:bg-[#3a2e26] rounded-full text-text-sub hover:bg-primary hover:text-white transition-colors">ğŸ±
                        ä¾¿å½“</button>
                </div>
            </div>

            <!-- é¥±è…¹æ„Ÿ -->
            <div class="bg-card-light dark:bg-card-dark rounded-2xl p-5 shadow-sm">
                <h2 class="font-bold text-text-main dark:text-white mb-4">é¥±è…¹æ„Ÿ</h2>
                <div class="flex justify-between" id="fullness-options">
                    <button class="emoji-btn flex flex-col items-center gap-2 p-3 rounded-xl" data-value="1">
                        <span class="text-3xl">ğŸ˜¢</span>
                        <span class="text-xs text-text-sub">è¿˜é¥¿</span>
                    </button>
                    <button class="emoji-btn flex flex-col items-center gap-2 p-3 rounded-xl" data-value="2">
                        <span class="text-3xl">ğŸ˜</span>
                        <span class="text-xs text-text-sub">åˆšå¥½</span>
                    </button>
                    <button class="emoji-btn flex flex-col items-center gap-2 p-3 rounded-xl" data-value="3">
                        <span class="text-3xl">ğŸ˜Š</span>
                        <span class="text-xs text-text-sub">æ»¡è¶³</span>
                    </button>
                    <button class="emoji-btn flex flex-col items-center gap-2 p-3 rounded-xl" data-value="4">
                        <span class="text-3xl">ğŸ¥´</span>
                        <span class="text-xs text-text-sub">æœ‰ç‚¹æ’‘</span>
                    </button>
                    <button class="emoji-btn flex flex-col items-center gap-2 p-3 rounded-xl" data-value="5">
                        <span class="text-3xl">ğŸ¤¢</span>
                        <span class="text-xs text-text-sub">æ’‘çˆ†äº†</span>
                    </button>
                </div>
            </div>

            <!-- æƒ…ç»ª -->
            <div class="bg-card-light dark:bg-card-dark rounded-2xl p-5 shadow-sm">
                <h2 class="font-bold text-text-main dark:text-white mb-4">åƒå®Œåå¿ƒæƒ…</h2>
                <div class="flex justify-between" id="mood-options">
                    <button class="emoji-btn flex flex-col items-center gap-2 p-3 rounded-xl" data-value="happy">
                        <span class="text-3xl">ğŸ˜„</span>
                        <span class="text-xs text-text-sub">å¼€å¿ƒ</span>
                    </button>
                    <button class="emoji-btn flex flex-col items-center gap-2 p-3 rounded-xl" data-value="satisfied">
                        <span class="text-3xl">ğŸ˜Œ</span>
                        <span class="text-xs text-text-sub">æ»¡è¶³</span>
                    </button>
                    <button class="emoji-btn flex flex-col items-center gap-2 p-3 rounded-xl" data-value="neutral">
                        <span class="text-3xl">ğŸ˜</span>
                        <span class="text-xs text-text-sub">ä¸€èˆ¬</span>
                    </button>
                    <button class="emoji-btn flex flex-col items-center gap-2 p-3 rounded-xl" data-value="guilty">
                        <span class="text-3xl">ğŸ˜“</span>
                        <span class="text-xs text-text-sub">æœ‰ç‚¹æ„§ç–š</span>
                    </button>
                    <button class="emoji-btn flex flex-col items-center gap-2 p-3 rounded-xl" data-value="regret">
                        <span class="text-3xl">ğŸ˜­</span>
                        <span class="text-xs text-text-sub">åæ‚”</span>
                    </button>
                </div>
            </div>

            <!-- åæ‚”åº¦ -->
            <div class="bg-card-light dark:bg-card-dark rounded-2xl p-5 shadow-sm">
                <h2 class="font-bold text-text-main dark:text-white mb-4">åæ‚”æŒ‡æ•°</h2>
                <p class="text-sm text-text-sub mb-4">å¦‚æœæ˜å¤©é†’æ¥ï¼Œä½ ä¼šåæ‚”ä»Šå¤©è¿™é¡¿å—ï¼Ÿ</p>
                <div class="flex justify-center gap-2" id="regret-options">
                    <button class="regret-star text-3xl text-[#e0d5ca] dark:text-[#5c4a3d] transition-colors"
                        data-value="1">â­</button>
                    <button class="regret-star text-3xl text-[#e0d5ca] dark:text-[#5c4a3d] transition-colors"
                        data-value="2">â­</button>
                    <button class="regret-star text-3xl text-[#e0d5ca] dark:text-[#5c4a3d] transition-colors"
                        data-value="3">â­</button>
                    <button class="regret-star text-3xl text-[#e0d5ca] dark:text-[#5c4a3d] transition-colors"
                        data-value="4">â­</button>
                    <button class="regret-star text-3xl text-[#e0d5ca] dark:text-[#5c4a3d] transition-colors"
                        data-value="5">â­</button>
                </div>
                <p class="text-center text-xs text-text-sub mt-2" id="regret-label">ç‚¹å‡»é€‰æ‹©åæ‚”ç¨‹åº¦</p>
            </div>

            <!-- èŠ±äº†å¤šå°‘é’± -->
            <div class="bg-card-light dark:bg-card-dark rounded-2xl p-5 shadow-sm">
                <h2 class="font-bold text-text-main dark:text-white mb-4">èŠ±äº†å¤šå°‘é’±ï¼Ÿ</h2>
                <div class="flex items-center gap-2">
                    <span class="text-xl text-primary">Â¥</span>
                    <input type="number" id="price-input" placeholder="0" min="0" step="0.1"
                        class="flex-1 px-4 py-3 rounded-xl bg-accent-cream/50 dark:bg-[#3a2e26] border-none text-text-main dark:text-white text-xl font-bold text-center focus:outline-none focus:ring-2 focus:ring-primary">
                </div>
            </div>

            <!-- æäº¤æŒ‰é’® -->
            <button id="submit-btn"
                class="w-full h-14 bg-primary hover:bg-primary-hover text-white rounded-2xl font-bold text-lg shadow-md shadow-primary/20 transition-all flex items-center justify-center gap-2">
                <span class="material-symbols-outlined">save</span>
                è®°å½•è¿™é¡¿
            </button>

            <!-- å†å²è®°å½•å…¥å£ -->
            <a href="review-history.html" class="block text-center text-primary text-sm hover:underline">
                ğŸ“Š æŸ¥çœ‹æˆ‘çš„é¥®é£ŸæŠ¥å‘Š
            </a>
        </main>
    </div>

    <script>
        // çŠ¶æ€ç®¡ç†
        const state = {
            food: '',
            fullness: null,
            mood: null,
            regret: null,
            price: null
        };

        // å¿«æ·é£Ÿç‰©æŒ‰é’®
        document.querySelectorAll('.quick-food').forEach(btn => {
            btn.addEventListener('click', () => {
                document.getElementById('food-input').value = btn.textContent.trim();
                state.food = btn.textContent.trim();
            });
        });

        // é£Ÿç‰©è¾“å…¥
        document.getElementById('food-input').addEventListener('input', (e) => {
            state.food = e.target.value;
        });

        // ä»·æ ¼è¾“å…¥
        document.getElementById('price-input').addEventListener('input', (e) => {
            state.price = parseFloat(e.target.value) || null;
        });

        // é€šç”¨é€‰æ‹©å™¨åˆå§‹åŒ–
        function initEmojiSelector(containerId, stateKey) {
            const container = document.getElementById(containerId);
            container.querySelectorAll('.emoji-btn').forEach(btn => {
                btn.addEventListener('click', () => {
                    container.querySelectorAll('.emoji-btn').forEach(b => b.classList.remove('selected', 'bg-accent-cream', 'dark:bg-[#3a2e26]'));
                    btn.classList.add('selected', 'bg-accent-cream', 'dark:bg-[#3a2e26]');
                    state[stateKey] = btn.dataset.value;
                });
            });
        }

        initEmojiSelector('fullness-options', 'fullness');
        initEmojiSelector('mood-options', 'mood');

        // åæ‚”æ˜Ÿæ˜Ÿ
        const regretLabels = {
            1: 'å®Œå…¨ä¸åæ‚” ğŸ‘',
            2: 'æœ‰ä¸€ç‚¹ç‚¹ ğŸ¤',
            3: 'æœ‰äº›åæ‚” ğŸ˜…',
            4: 'æ¯”è¾ƒåæ‚” ğŸ˜“',
            5: 'éå¸¸åæ‚” ğŸ˜­'
        };

        document.querySelectorAll('.regret-star').forEach(star => {
            star.addEventListener('click', () => {
                const value = parseInt(star.dataset.value);
                state.regret = value;

                document.querySelectorAll('.regret-star').forEach(s => {
                    const v = parseInt(s.dataset.value);
                    s.style.color = v <= value ? '#d4a574' : '';
                });

                document.getElementById('regret-label').textContent = regretLabels[value];
            });
        });

        // æäº¤
        document.getElementById('submit-btn').addEventListener('click', async () => {
            if (!state.food) {
                alert('è¯·è¾“å…¥ä½ åƒäº†ä»€ä¹ˆ');
                return;
            }

            const record = {
                ...state,
                timestamp: new Date().toISOString(),
                user_token: localStorage.getItem('user_token') || generateUserToken()
            };

            // ä¿å­˜åˆ°æœ¬åœ°å­˜å‚¨ï¼ˆåç»­å¯ä»¥åŒæ­¥åˆ°æœåŠ¡å™¨ï¼‰
            const history = JSON.parse(localStorage.getItem('meal_history') || '[]');
            history.push(record);
            localStorage.setItem('meal_history', JSON.stringify(history));

            // æ˜¾ç¤ºæˆåŠŸæç¤º
            alert('âœ… è®°å½•æˆåŠŸï¼åšæŒè®°å½•ï¼Œ7å¤©åå¯ä»¥çœ‹åˆ°ä½ çš„é¥®é£ŸæŠ¥å‘Š');

            // é‡ç½®è¡¨å•
            location.reload();
        });

        // ç”ŸæˆåŒ¿åç”¨æˆ·token
        function generateUserToken() {
            const token = 'user_' + Math.random().toString(36).substr(2, 9);
            localStorage.setItem('user_token', token);
            return token;
        }
    </script>
</body>

</html>