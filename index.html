<!DOCTYPE html>
<html lang="zh-CN">

<head>
    <meta charset="utf-8" />
    <meta content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no, viewport-fit=cover"
        name="viewport" />
    <title>ä»Šå¤©åƒç‚¹å•¥ï¼Ÿ</title>
    <!-- Dependencies -->
    <script src="https://cdn.tailwindcss.com"></script>
    <script src="https://code.iconify.design/iconify-icon/1.0.7/iconify-icon.min.js"></script>
    <link href="https://api.fontshare.com/v2/css?f[]=zodiak@400,500,700&f[]=pally@400,500,700&display=swap"
        rel="stylesheet">

    <script>
        tailwind.config = {
            theme: {
                extend: {
                    colors: {
                        cream: '#fffcf8',
                        dusty: {
                            rose: '#d9a59d',
                            'rose-light': '#f4e4e1',
                            'rose-dark': '#b57b72',
                        },
                        sage: {
                            green: '#c8d5c4',
                            'green-light': '#e8f0e6',
                            'green-dark': '#8a9a85',
                        },
                        charcoal: '#5c5552',
                        'text-light': '#948c89'
                    },
                    fontFamily: {
                        serif: ['Zodiak', 'serif'],
                        sans: ['Pally', 'sans-serif'],
                    },
                    boxShadow: {
                        'bubble': '0 8px 24px -6px rgba(217, 165, 157, 0.25)',
                        'bubble-hover': '0 12px 32px -8px rgba(217, 165, 157, 0.4)',
                        'inner-soft': 'inset 0 2px 6px 0 rgba(255, 255, 255, 0.8)',
                        'glass': '0 8px 32px 0 rgba(217, 165, 157, 0.15)',
                        'card-soft': '0 10px 40px -10px rgba(0,0,0,0.08)',
                    },
                    animation: {
                        'float': 'float 6s ease-in-out infinite',
                        'float-delayed': 'float 6s ease-in-out 3s infinite',
                        'bounce-soft': 'bounce-soft 2s infinite',
                        'wiggle': 'wiggle 1s ease-in-out infinite',
                        'pop': 'pop 0.3s cubic-bezier(0.175, 0.885, 0.32, 1.275)',
                        'fade-in-up': 'fadeInUp 0.6s ease-out forwards',
                    },
                    keyframes: {
                        float: {
                            '0%, 100%': { transform: 'translateY(0)' },
                            '50%': { transform: 'translateY(-20px)' },
                        },
                        'bounce-soft': {
                            '0%, 100%': { transform: 'translateY(0)' },
                            '50%': { transform: 'translateY(-5px)' },
                        },
                        wiggle: {
                            '0%, 100%': { transform: 'rotate(-3deg)' },
                            '50%': { transform: 'rotate(3deg)' },
                        },
                        pop: {
                            '0%': { transform: 'scale(0.9)' },
                            '100%': { transform: 'scale(1)' },
                        },
                        fadeInUp: {
                            '0%': { opacity: '0', transform: 'translateY(20px)' },
                            '100%': { opacity: '1', transform: 'translateY(0)' },
                        }
                    }
                }
            }
        }
    </script>
    <style>
        /* Custom Range Slider Styling */
        input[type=range] {
            -webkit-appearance: none;
            background: transparent;
            width: 100%;
        }

        input[type=range]::-webkit-slider-thumb {
            -webkit-appearance: none;
            height: 28px;
            width: 28px;
            border-radius: 50%;
            background: #d9a59d;
            border: 4px solid #fff;
            box-shadow: 0 4px 10px rgba(217, 165, 157, 0.5);
            cursor: pointer;
            margin-top: -12px;
            transition: transform 0.2s cubic-bezier(0.175, 0.885, 0.32, 1.275);
        }

        input[type=range]::-webkit-slider-thumb:hover {
            transform: scale(1.3);
        }

        input[type=range]:active::-webkit-slider-thumb {
            transform: scale(0.95);
            background: #b57b72;
        }

        input[type=range]::-webkit-slider-runnable-track {
            width: 100%;
            height: 6px;
            cursor: pointer;
            background: linear-gradient(to right, #e8f0e6, #d9a59d);
            border-radius: 99px;
        }

        /* Staggered Animation Delays */
        .delay-100 {
            animation-delay: 100ms;
        }

        .delay-200 {
            animation-delay: 200ms;
        }

        .delay-300 {
            animation-delay: 300ms;
        }

        .delay-400 {
            animation-delay: 400ms;
        }

        .delay-500 {
            animation-delay: 500ms;
        }

        .card-enter {
            opacity: 0;
            animation: fadeInUp 0.8s cubic-bezier(0.2, 0.8, 0.2, 1) forwards;
        }

        /* Hover interactions */
        .hover-lift {
            transition: transform 0.3s cubic-bezier(0.34, 1.56, 0.64, 1);
        }

        .hover-lift:hover {
            transform: translateY(-4px) scale(1.02);
        }

        /* Keyframes Definitions (Moved from Tailwind Config for Reliability) */
        @keyframes float {

            0%,
            100% {
                transform: translateY(0);
            }

            50% {
                transform: translateY(-20px);
            }
        }

        @keyframes bounce-soft {

            0%,
            100% {
                transform: translateY(0);
            }

            50% {
                transform: translateY(-5px);
            }
        }

        @keyframes wiggle {

            0%,
            100% {
                transform: rotate(-3deg);
            }

            50% {
                transform: rotate(3deg);
            }
        }

        @keyframes pop {
            0% {
                transform: scale(0.9);
            }

            100% {
                transform: scale(1);
            }
        }

        @keyframes fadeInUp {
            0% {
                opacity: 0;
                transform: translateY(20px);
            }

            100% {
                opacity: 1;
                transform: translateY(0);
            }
        }

        /* Utility classes matching the Tailwind config names for convenience */
        .animate-float {
            animation: float 6s ease-in-out infinite;
        }

        .animate-float-delayed {
            animation: float 6s ease-in-out 3s infinite;
        }

        .animate-bounce-soft {
            animation: bounce-soft 2s infinite;
        }

        .animate-wiggle {
            animation: wiggle 1s ease-in-out infinite;
        }

        .animate-pop {
            animation: pop 0.3s cubic-bezier(0.175, 0.885, 0.32, 1.275);
        }

        .animate-fade-in-up {
            animation: fadeInUp 0.6s ease-out forwards;
        }
    </style>
</head>

<body
    class="min-h-screen bg-cream text-charcoal font-sans p-6 md:p-12 relative overflow-x-hidden selection:bg-dusty-rose selection:text-white">

    <!-- Animated Background Blobs -->
    <div
        class="fixed top-[-10%] left-[-10%] w-[500px] h-[500px] rounded-full bg-sage-green/20 blur-[100px] animate-float pointer-events-none z-0">
    </div>
    <div
        class="fixed bottom-[-10%] right-[-10%] w-[600px] h-[600px] rounded-full bg-dusty-rose/10 blur-[100px] animate-float-delayed pointer-events-none z-0">
    </div>

    <div class="relative z-10 max-w-4xl mx-auto pb-32">

        <!-- Header -->
        <header class="flex flex-col items-center justify-center mb-12 card-enter delay-100">
            <div class="mb-6 relative group cursor-pointer"
                onclick="this.classList.add('animate-pop'); setTimeout(() => this.classList.remove('animate-pop'), 300)">
                <div class="absolute inset-0 bg-dusty-rose/20 rounded-full blur-xl scale-150 animate-pulse"></div>
                <div
                    class="relative p-6 rounded-full bg-white shadow-bubble text-dusty-rose transition-transform group-hover:scale-110 duration-300 group-hover:rotate-12">
                    <iconify-icon icon="lucide:utensils" class="text-4xl"></iconify-icon>
                </div>
            </div>
            <h1
                class="font-serif text-4xl md:text-[3.5rem] leading-none text-charcoal font-bold text-center mb-3 tracking-tight">
                ä»Šå¤© <span class="italic text-dusty-rose relative inline-block transform -rotate-2">
                    åƒç‚¹å•¥ï¼Ÿ
                    <iconify-icon icon="lucide:sparkles"
                        class="text-2xl absolute -top-4 -right-6 text-sage-green animate-bounce-soft"></iconify-icon>
                </span>
            </h1>
            <p
                class="text-text-light font-medium tracking-wide text-sm bg-white/60 backdrop-blur-sm px-6 py-2 rounded-full border border-white/50 shadow-sm mt-2">
                åˆ«çº ç»“å•¦ï¼Œè®©è‚šå­åšå†³å®š âœ¨
            </p>
        </header>

        <!-- Main Grid -->
        <div class="grid grid-cols-1 md:grid-cols-2 gap-6 md:gap-8">

            <!-- 1. Time Selector -->
            <div
                class="p-6 border border-white/60 rounded-[2.5rem] bg-white/40 backdrop-blur-md shadow-card-soft card-enter delay-200 hover:bg-white/50 transition-colors duration-500">
                <h2
                    class="text-xs uppercase tracking-widest text-text-light mb-5 flex items-center gap-2 font-bold opacity-80 pl-1">
                    <iconify-icon icon="lucide:clock" class="text-sage-green-dark"></iconify-icon> é¥­ç‚¹æ—¶åˆ»
                </h2>
                <div class="grid grid-cols-2 gap-4" id="time-options">
                    <button
                        class="choice-btn h-16 rounded-3xl bg-white text-text-light hover:text-dusty-rose hover:shadow-bubble transition-all font-medium text-base border border-transparent hover-lift flex items-center justify-center gap-2 group"
                        onclick="selectOption('time_of_day', 'daytime', this)">
                        <span>é˜³å…‰æ­£å¥½</span>
                    </button>
                    <button
                        class="choice-btn h-16 rounded-3xl bg-white text-text-light hover:text-dusty-rose hover:shadow-bubble transition-all font-medium text-base border border-transparent hover-lift flex items-center justify-center gap-2 group"
                        onclick="selectOption('time_of_day', 'nighttime', this)">
                        <span>æœˆè‰²æ¸©æŸ”</span>
                    </button>
                </div>
            </div>

            <!-- 2. Exercise -->
            <div
                class="p-6 border border-white/60 rounded-[2.5rem] bg-white/40 backdrop-blur-md shadow-card-soft card-enter delay-300 hover:bg-white/50 transition-colors duration-500">
                <h2
                    class="text-xs uppercase tracking-widest text-text-light mb-5 flex items-center gap-2 font-bold opacity-80 pl-1">
                    <iconify-icon icon="lucide:activity" class="text-sage-green-dark"></iconify-icon> åŠ¨æ²¡åŠ¨å‘€
                </h2>
                <div class="bg-white p-5 rounded-[2rem] shadow-glass flex flex-col justify-between h-36 cursor-pointer hover-lift relative overflow-hidden group"
                    id="exercise-card" onclick="toggleExercise()">
                    <!-- Decorative blob -->
                    <div
                        class="absolute -right-8 -bottom-8 w-24 h-24 bg-sage-green/10 rounded-full blur-xl group-hover:scale-150 transition-transform duration-700">
                    </div>

                    <div class="flex justify-between items-start relative z-10">
                        <div class="w-12 h-12 rounded-2xl bg-sage-green/10 flex items-center justify-center text-sage-green-dark transition-all duration-300 group-hover:rotate-12"
                            id="exercise-icon-bg">
                            <iconify-icon icon="lucide:dumbbell" class="text-2xl"></iconify-icon>
                        </div>
                        <div class="w-8 h-8 rounded-full border-2 border-sage-green flex items-center justify-center transition-all bg-transparent"
                            id="exercise-check">
                            <iconify-icon icon="lucide:check"
                                class="text-white text-lg opacity-0 transition-opacity scale-50"
                                id="exercise-check-icon"></iconify-icon>
                        </div>
                    </div>
                    <div class="relative z-10 pl-1">
                        <span class="block font-serif text-xl text-charcoal tracking-tight"
                            id="exercise-text">ä»Šå¤©æ²¡åŠ¨å¼¹</span>
                        <span class="text-xs text-text-light font-medium mt-1 block" id="exercise-subtext">åšä¸€ä¸ªå¿«ä¹çš„å°åœŸè±†
                            ğŸ¥”</span>
                    </div>
                </div>
            </div>

            <!-- 3. Mood -->
            <div
                class="md:col-span-2 p-6 border border-white/60 rounded-[2.5rem] bg-white/40 backdrop-blur-md shadow-card-soft card-enter delay-400 hover:bg-white/50 transition-colors duration-500">
                <h2
                    class="text-xs uppercase tracking-widest text-text-light mb-5 flex items-center gap-2 font-bold opacity-80 pl-1">
                    <iconify-icon icon="lucide:smile" class="text-sage-green-dark"></iconify-icon> å¿ƒæƒ…å’‹æ ·
                </h2>
                <div class="grid grid-cols-2 md:grid-cols-4 gap-4" id="mood-options">
                    <button
                        class="choice-btn h-20 rounded-3xl bg-white text-text-light hover:text-dusty-rose hover:shadow-bubble transition-all font-medium text-sm border border-transparent hover-lift flex flex-col items-center justify-center gap-1 group"
                        onclick="selectOption('mood', 'stressed', this)">
                        <span>è„‘å£³ç–¼</span>
                    </button>
                    <button
                        class="choice-btn h-20 rounded-3xl bg-white text-text-light hover:text-dusty-rose hover:shadow-bubble transition-all font-medium text-sm border border-transparent hover-lift flex flex-col items-center justify-center gap-1 group"
                        onclick="selectOption('mood', 'homesick', this)">
                        <span>æƒ³å®¶äº†</span>
                    </button>
                    <button
                        class="choice-btn h-20 rounded-3xl bg-white text-text-light hover:text-dusty-rose hover:shadow-bubble transition-all font-medium text-sm border border-transparent hover-lift flex flex-col items-center justify-center gap-1 group"
                        onclick="selectOption('mood', 'finished_work', this)">
                        <span>è‡ªç”±å•¦!</span>
                    </button>
                    <button
                        class="choice-btn h-20 rounded-3xl bg-white text-text-light hover:text-dusty-rose hover:shadow-bubble transition-all font-medium text-sm border border-transparent hover-lift flex flex-col items-center justify-center gap-1 group"
                        onclick="selectOption('mood', 'lonely', this)">
                        <span>æœ‰ç‚¹emo</span>
                    </button>
                </div>
            </div>

            <!-- 4. Body Status -->
            <div
                class="md:col-span-2 p-6 border border-white/60 rounded-[2.5rem] bg-white/40 backdrop-blur-md shadow-card-soft card-enter delay-500 hover:bg-white/50 transition-colors duration-500">
                <h2
                    class="text-xs uppercase tracking-widest text-text-light mb-5 flex items-center gap-2 font-bold opacity-80 pl-1">
                    <iconify-icon icon="lucide:heart-pulse" class="text-sage-green-dark"></iconify-icon> èº«ä½“æƒ³è¦...
                </h2>
                <div
                    class="bg-white p-2 rounded-full shadow-inner-soft flex flex-col md:flex-row w-full relative h-auto md:h-16 overflow-hidden md:overflow-visible hover:shadow-inner transition-shadow duration-300">
                    <!-- Buttons Container -->
                    <div class="flex w-full flex-col md:flex-row relative z-10" id="body-options">
                        <button
                            class="choice-btn flex-1 py-4 md:py-0 rounded-full text-sm font-bold text-text-light hover:text-dusty-rose transition-all relative group"
                            onclick="selectBodyOption('hunger_level', 'culinary_hug', this)">
                            æ±‚å®‰æ…°
                        </button>
                        <button
                            class="choice-btn flex-1 py-4 md:py-0 rounded-full text-sm font-bold text-text-light hover:text-dusty-rose transition-all relative group"
                            onclick="selectBodyOption('hunger_level', 'crunch', this)">
                            å˜´å·´å¯‚å¯
                        </button>
                        <button
                            class="choice-btn flex-1 py-4 md:py-0 rounded-full text-sm font-bold text-text-light hover:text-dusty-rose transition-all relative group"
                            onclick="selectBodyOption('hunger_level', 'energy_needed', this)">
                            æé€Ÿå……ç”µ
                        </button>
                    </div>
                </div>
            </div>

            <!-- 5. Budget -->
            <div
                class="md:col-span-2 p-6 border border-white/60 rounded-[2.5rem] bg-white/40 backdrop-blur-md shadow-card-soft card-enter delay-500 hover:bg-white/50 transition-colors duration-500">
                <h2
                    class="text-xs uppercase tracking-widest text-text-light mb-5 flex items-center gap-2 font-bold opacity-80 pl-1">
                    <iconify-icon icon="lucide:wallet" class="text-sage-green-dark"></iconify-icon> é’±åŒ…ä½™é¢
                </h2>
                <div
                    class="bg-white p-8 rounded-[2rem] shadow-glass flex flex-col justify-between relative overflow-hidden group">
                    <!-- Dynamic BG Emoji -->
                    <div class="absolute -right-4 -bottom-4 text-[8rem] opacity-[0.03] group-hover:opacity-[0.06] transition-opacity select-none pointer-events-none"
                        id="budget-emoji-bg">
                        ğŸ’¸
                    </div>

                    <div class="flex justify-between items-center px-1 mb-6 relative z-10">
                        <span class="text-sm font-bold text-charcoal">é¢„è®¡èŠ±å¤šå°‘?</span>
                        <div class="flex items-center gap-2">
                            <span id="budget-emoji-small" class="text-base animate-bounce-soft">ğŸ’¸</span>
                            <span id="budget-display"
                                class="text-xs font-bold text-dusty-rose bg-dusty-rose/10 px-4 py-1.5 rounded-full transition-all">
                                æ‹–æ‹–çœ‹ ->
                            </span>
                        </div>
                    </div>
                    <div class="px-2 pb-2 relative z-10">
                        <input type="range" min="1" max="5" value="3" class="w-full focus:outline-none"
                            id="budget-slider" oninput="updateBudget(this.value)">
                        <div
                            class="flex justify-between text-[10px] text-text-light font-bold mt-4 uppercase tracking-wide px-1 opacity-60">
                            <span>åƒåœŸ</span>
                            <span></span>
                            <span>æ—¥å¸¸</span>
                            <span></span>
                            <span>è±ªå</span>
                        </div>
                    </div>
                </div>
            </div>

            <!-- 6. Submit Button -->
            <div
                class="md:col-span-2 p-8 border border-white/60 rounded-[2.5rem] bg-white/40 backdrop-blur-md shadow-card-soft card-enter delay-500">
                <button id="submit-btn" onclick="submitChoices()" disabled
                    class="w-full py-6 rounded-full bg-white text-text-light font-serif text-xl tracking-wide shadow-sm transition-all duration-500 flex items-center justify-center gap-3 group overflow-hidden relative cursor-not-allowed opacity-60 hover:shadow-md">
                    <span
                        class="absolute inset-0 bg-gradient-to-r from-dusty-rose to-[#e6b2aa] translate-y-full transition-transform duration-500 rounded-full z-0"
                        id="btn-bg"></span>
                    <span class="relative z-10 transition-colors duration-300">å‘Šè¯‰æˆ‘åƒå•¥!</span>
                    <iconify-icon icon="lucide:send"
                        class="relative z-10 group-hover:translate-x-1 group-hover:-translate-y-1 transition-transform duration-500 text-2xl"></iconify-icon>
                </button>
            </div>

        </div>

        <!-- Family Meal Entry (Subtle) -->
        <div class="mt-12 text-center card-enter delay-500">
            <div class="p-8 border border-sage-green/30 rounded-[2.5rem] bg-sage-green-light/30 backdrop-blur-sm">
                <p class="text-charcoal font-medium text-lg mb-4">ä¸çŸ¥é“ä»Šæ™šåƒä»€ä¹ˆï¼Ÿ ğŸ¤”</p>
                <a href="family.html"
                    class="inline-flex items-center gap-2 px-8 py-4 rounded-full bg-sage-green text-white font-bold text-base shadow-bubble hover:shadow-bubble-hover hover:-translate-y-1 transition-all duration-300 group">
                    <iconify-icon icon="lucide:home" class="text-xl"></iconify-icon>
                    <span>å¸®æˆ‘é…ä¸€é¡¿å®¶å¸¸é¥­</span>
                    <iconify-icon icon="lucide:arrow-right"
                        class="text-lg group-hover:translate-x-1 transition-transform"></iconify-icon>
                </a>
            </div>
        </div>

        <!-- Divider -->
        <div class="mt-12 flex items-center justify-center opacity-40">
            <div class="flex-1 h-px bg-gradient-to-r from-transparent via-dusty-rose/50 to-transparent"></div>
            <iconify-icon icon="lucide:sparkles" class="mx-4 text-dusty-rose text-sm"></iconify-icon>
            <div class="flex-1 h-px bg-gradient-to-l from-transparent via-dusty-rose/50 to-transparent"></div>
        </div>

        <!-- Footer -->
        <div class="mt-12 text-center opacity-70 card-enter delay-500">
            <p class="font-serif text-charcoal italic text-lg leading-snug max-w-[260px] mx-auto">
                "äººå¦‚å…¶é£Ÿï¼Œæ‹’ç»é€Ÿæˆã€å»‰ä»·ä¸è™šå‡ã€‚"
            </p>
            <div class="mt-6 w-16 h-1 bg-sage-green/30 rounded-full mx-auto"></div>
        </div>

    </div>

    <script>
        // State
        const userChoices = {
            time_of_day: null,
            mood: null,
            hunger_level: null,
            exercised_today: null,
            budget_level: 3
        };

        const budgetData = {
            1: { label: "15å…ƒä»¥ä¸‹ (çœé’±å°åˆ†é˜Ÿ)", emoji: "ğŸ¥¬" },
            2: { label: "15-25å…ƒ (å‡‘åˆåƒç‚¹)", emoji: "ğŸœ" },
            3: { label: "25-40å…ƒ (å¯¹è‡ªå·±å¥½ç‚¹)", emoji: "ğŸ¥—" },
            4: { label: "40-80å…ƒ (å°å°å¥¢ä¾ˆ)", emoji: "ğŸ¥©" },
            5: { label: "80å…ƒ+ (å¯Œè´µè¿·äººçœ¼)", emoji: "ğŸ¦" }
        };

        const choiceLabels = {
            time_of_day: { daytime: 'ç™½å¤©', nighttime: 'å¤œæ™š' },
            mood: { stressed: 'å‹åŠ›å±±å¤§', homesick: 'æœ‰ç‚¹æƒ³å®¶', finished_work: 'ç»ˆäºå¿™å®Œäº†', lonely: 'æœ‰äº›å­¤å•' },
            hunger_level: { culinary_hug: 'æƒ³è¢«ç¾é£Ÿæ²»æ„ˆ', crunch: 'æƒ³åš¼ç‚¹ä»€ä¹ˆ', energy_needed: 'æ€¥éœ€èƒ½é‡' },
            exercised_today: { true: 'è¿åŠ¨äº†', false: 'æ²¡è¿åŠ¨' },
            budget_level: { 1: '5-15å…ƒ', 2: '15-25å…ƒ', 3: '25-40å…ƒ', 4: '40-80å…ƒ', 5: '80å…ƒä»¥ä¸Š' }
        };

        // --- Interaction Functions ---

        function selectOption(field, value, element) {
            userChoices[field] = value;

            const parent = element.parentElement;
            const siblings = parent.querySelectorAll('.choice-btn');

            siblings.forEach(btn => {
                // Reset to default playful style
                btn.className = "choice-btn h-16 md:h-20 rounded-3xl bg-white text-text-light hover:text-dusty-rose hover:shadow-bubble transition-all font-medium text-sm md:text-base border border-transparent hover-lift flex flex-col md:flex-row items-center justify-center gap-1 md:gap-2 group opacity-60 hover:opacity-100 scale-95 hover:scale-100";
            });

            // Active visual: Pop out, fill color
            element.className = "choice-btn h-16 md:h-20 rounded-3xl bg-dusty-rose text-white shadow-bubble-hover font-bold text-sm md:text-base relative overflow-hidden group transform scale-100 ring-4 ring-dusty-rose/20 flex flex-col md:flex-row items-center justify-center gap-1 md:gap-2 animate-pop transition-all";

            checkCompletion();
        }

        function selectBodyOption(field, value, element) {
            userChoices[field] = value;

            const parent = document.getElementById('body-options');
            const siblings = parent.querySelectorAll('button');

            siblings.forEach(btn => {
                btn.className = "choice-btn flex-1 py-4 md:py-0 rounded-full text-sm font-medium text-text-light hover:text-dusty-rose transition-colors relative z-10 opacity-70 hover:opacity-100";
            });

            element.className = "choice-btn flex-1 py-4 md:py-0 rounded-full text-sm font-bold text-white bg-dusty-rose shadow-md transition-all relative z-10 transform scale-105";

            checkCompletion();
        }

        function toggleExercise() {
            if (userChoices.exercised_today === null) {
                userChoices.exercised_today = false;
            } else {
                userChoices.exercised_today = !userChoices.exercised_today;
            }
            updateExerciseVisuals();
            checkCompletion();
        }

        function updateExerciseVisuals() {
            const iconBg = document.getElementById('exercise-icon-bg');
            const checkIcon = document.getElementById('exercise-check-icon');
            const mainText = document.getElementById('exercise-text');
            const subText = document.getElementById('exercise-subtext');
            const checkContainer = document.getElementById('exercise-check');

            if (userChoices.exercised_today === true) {
                // Active (Yes)
                checkContainer.className = "w-8 h-8 rounded-full border-2 border-sage-green bg-sage-green flex items-center justify-center transition-all shadow-sm";
                checkIcon.classList.remove('opacity-0', 'scale-50');
                checkIcon.classList.add('scale-100');
                mainText.innerText = "ğŸ’¦ ç‹ ç‹ æµæ±—äº†";
                subText.innerText = "å¤šåƒç‚¹å¥½çš„è¡¥ä¸€è¡¥ï¼";
                subText.className = "text-xs text-sage-green-dark font-bold mt-1 block animate-bounce-soft";
                iconBg.className = "w-12 h-12 rounded-2xl bg-sage-green text-white flex items-center justify-center transition-colors rotate-12 shadow-inner";
            } else {
                // Inactive (No)
                checkContainer.className = "w-8 h-8 rounded-full border-2 border-sage-green bg-transparent flex items-center justify-center transition-all";
                checkIcon.classList.add('opacity-0', 'scale-50');
                checkIcon.classList.remove('scale-100');
                mainText.innerText = "ğŸ¥” ä»Šå¤©å½“ä¸ªåœŸè±†";
                subText.innerText = "ä¸åŠ¨æ€ä¹ˆäº†ï¼Ÿåƒé¥±äº†æ‰æœ‰åŠ›æ°”åŠ¨";
                subText.className = "text-xs text-text-light font-medium mt-1 block";
                iconBg.className = "w-12 h-12 rounded-2xl bg-sage-green/10 text-sage-green-dark flex items-center justify-center transition-colors shadow-none";
            }
        }

        function updateBudget(value) {
            userChoices.budget_level = parseInt(value);
            const data = budgetData[value];

            const display = document.getElementById('budget-display');
            const emojiSmall = document.getElementById('budget-emoji-small');
            const emojiBg = document.getElementById('budget-emoji-bg');

            display.innerText = data.label;
            emojiSmall.innerText = data.emoji;
            emojiBg.innerText = data.emoji;

            checkCompletion();
        }

        // Init
        updateBudget(3);

        function checkCompletion() {
            const isTimeSet = userChoices.time_of_day !== null;
            const isMoodSet = userChoices.mood !== null;
            const isBodySet = userChoices.hunger_level !== null;
            const isExerciseSet = userChoices.exercised_today !== null;

            const btn = document.getElementById('submit-btn');
            const btnBg = document.getElementById('btn-bg');

            if (isTimeSet && isMoodSet && isBodySet && isExerciseSet) {
                btn.disabled = false;
                btn.classList.remove('cursor-not-allowed', 'opacity-60');
                btn.classList.add('hover:-translate-y-1', 'active:translate-y-0', 'shadow-bubble');
                btnBg.classList.remove('translate-y-full'); // Fill color
            } else {
                btn.disabled = true;
                btn.classList.add('cursor-not-allowed', 'opacity-60');
                btn.classList.remove('hover:-translate-y-1', 'active:translate-y-0', 'shadow-bubble');
                btnBg.classList.add('translate-y-full');
            }
        }

        function submitChoices() {
            if (document.getElementById('submit-btn').disabled) return;

            // Animate out
            document.querySelector('.max-w-4xl').style.transform = 'scale(0.95) translateY(-20px)';
            document.querySelector('.max-w-4xl').style.opacity = '0';
            document.querySelector('.max-w-4xl').style.transition = 'all 0.5s ease-in';

            sessionStorage.setItem('userChoices', JSON.stringify(userChoices));
            sessionStorage.setItem('choiceLabels', JSON.stringify({
                time: choiceLabels.time_of_day[userChoices.time_of_day],
                mood: choiceLabels.mood[userChoices.mood],
                hunger: choiceLabels.hunger_level[userChoices.hunger_level],
                exercise: choiceLabels.exercised_today[userChoices.exercised_today],
                budget: choiceLabels.budget_level[userChoices.budget_level]
            }));

            setTimeout(() => {
                window.location.href = 'result.html';
            }, 600);
        }
    </script>
</body>

</html>